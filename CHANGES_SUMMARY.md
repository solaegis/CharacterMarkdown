# Changes Summary - 2025-01-19

## Overview
Three distinct changes implemented in this session:

1. âœ… **Mundus Stone Relocation** - Moved into Character Overview table
2. âœ… **Footer Cleanup** - Removed large profile warning and character count
3. âœ… **Skill Bars Setting** - Added toggle control for skill bars section

---

## Change #1: Mundus Stone Relocation

### What Changed
Moved Mundus Stone information from a standalone section into the Character Overview table.

### Files Modified
- `src/generators/Markdown.lua`

### Changes Made

**1. Updated `GenerateOverview()` function signature**
```lua
-- BEFORE
function GenerateOverview(characterData, roleData, locationData, buffsData, settings, format)

-- AFTER  
function GenerateOverview(characterData, roleData, locationData, buffsData, mundusData, settings, format)
```

**2. Added Mundus row to Overview table**
```lua
-- Mundus Stone (inserted after Title, before Role)
if mundusData and mundusData.active then
    local mundusText = CreateMundusLink(mundusData.name, format)
    markdown = markdown .. "| **ğŸª¨ Mundus Stone** | " .. mundusText .. " |\n"
end
```

**3. Updated function call in main flow**
```lua
-- BEFORE
markdown = markdown .. GenerateOverview(characterData, roleData, locationData, buffsData, settings, format)

-- AFTER
markdown = markdown .. GenerateOverview(characterData, roleData, locationData, buffsData, mundusData, settings, format)
```

**4. Made Mundus section Discord-only**
```lua
-- BEFORE
markdown = markdown .. GenerateMundus(mundusData, format)

-- AFTER
if format == "discord" then
    markdown = markdown .. GenerateMundus(mundusData, format)
end
```

### Result
- **GitHub/VS Code:** Mundus appears as a row in Character Overview table
- **Discord:** Unchanged - maintains standalone section
- **Quick:** No change (quick format doesn't show mundus)

### Row Order in Overview Table
```
1. Race
2. Class
3. Alliance  
4. Level
5. Champion Points
6. ESO Plus
7. Title (if present)
8. ğŸª¨ Mundus Stone (if active) â† NEW
9. Role (if enabled)
10. Location (if enabled)
11. Attributes (if enabled)
12. Active Buffs (if enabled)
```

---

## Change #2: Footer Cleanup

### What Changed
Removed the large profile warning and character count from footer.

### Files Modified
- `src/generators/Markdown.lua` - `GenerateFooter()` function

### Removed Code

**GitHub format:**
```lua
// REMOVED:
if charCount > 8000 then
    markdown = markdown .. "*âš ï¸ Large profile (" .. FormatNumber(charCount) .. " chars) - ESO clipboard may truncate*\n\n"
    markdown = markdown .. "*Tip: Disable some sections in settings to reduce size*\n\n"
end
```

**Discord/VS Code format:**
```lua
// REMOVED:
markdown = markdown .. string.rep(" ", 25) .. "Character Count: " .. FormatNumber(charCount) .. " chars\n"

if format == "discord" and charCount > 2000 then
    markdown = markdown .. string.rep(" ", 18) .. "âš ï¸ Exceeds Discord limit - split required\n"
end

if charCount > 8000 then
    markdown = markdown .. string.rep(" ", 15) .. "âš ï¸ ESO clipboard may truncate at ~8,000 chars\n"
    markdown = markdown .. string.rep(" ", 15) .. "Disable sections in settings to reduce size\n"
end
```

### New Footer Format

**GitHub:**
```markdown
<div align="center">

**Generated by Character Markdown v2.1.0**

*Format: GITHUB*

</div>

```

**Discord/VS Code:**
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                    Generated by Character Markdown v2.1.0
                              Format: DISCORD
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### Added Change
**Added newline at end:** Changed from `\n\n\n` to `\n\n` for cleaner output

---

## Change #3: Skill Bars Setting Toggle

### What Changed
Added `includeSkillBars` setting to allow users to hide the Combat Arsenal (skill bars) section.

### Files Modified
1. `src/generators/Markdown.lua`
2. `src/settings/Defaults.lua`
3. `src/settings/Panel.lua`

### Implementation

**1. Generator Logic (`Markdown.lua`)**
```lua
// BEFORE
-- Skill Bars
markdown = markdown .. GenerateSkillBars(skillBarData, format)

// AFTER
-- Skill Bars
if settings.includeSkillBars ~= false then
    markdown = markdown .. GenerateSkillBars(skillBarData, format)
end
```

**2. Default Setting (`Defaults.lua`)**
```lua
CharacterMarkdown.Settings.Defaults.CORE = {
    includeChampionPoints = true,
    includeSkillBars = true,        // â† NEW
    includeSkills = true,
    includeEquipment = true,
    // ...
}
```

**3. Settings UI (`Panel.lua`)**
```lua
table.insert(options, {
    type = "checkbox",
    name = "Include Skill Bars",
    tooltip = "Show front and back bar abilities with ultimates",
    getFunc = function() return CharacterMarkdownSettings.includeSkillBars end,
    setFunc = function(value) CharacterMarkdownSettings.includeSkillBars = value end,
    width = "half",
    default = true,
})
```

### UI Placement
The toggle appears in the **Core Content Sections** panel, positioned between:
- âœ… Include Champion Points
- âœ… **Include Skill Bars** â† NEW
- âœ… Include Skill Progression

---

## Testing Checklist

### Mundus Stone Relocation
- [ ] Verify mundus shows in Overview table for GitHub format
- [ ] Verify mundus shows in Overview table for VS Code format
- [ ] Verify Discord still has standalone Mundus section
- [ ] Verify no mundus shown when stone not active
- [ ] Verify row order is correct (after Title, before Role)

### Footer Cleanup
- [ ] Verify GitHub footer shows only version and format
- [ ] Verify Discord footer shows only version and format
- [ ] Verify VS Code footer shows only version and format  
- [ ] Verify no character count warnings appear
- [ ] Verify output ends with exactly one blank line

### Skill Bars Setting
- [ ] Verify skill bars show when `includeSkillBars = true` (default)
- [ ] Verify skill bars hidden when `includeSkillBars = false`
- [ ] Verify toggle appears in settings UI
- [ ] Verify default is enabled (checked in UI)
- [ ] Verify setting persists across reloads

### Integration Testing
- [ ] Generate profile with all changes - verify correct rendering
- [ ] Toggle skill bars off - verify section disappears
- [ ] Switch between formats - verify mundus behaves correctly
- [ ] Check footer in all formats - verify cleanup applied

---

## Git Commit Messages

### Commit 1: Mundus Stone Relocation
```
feat(ui): Move Mundus Stone into Character Overview table

- Consolidated mundus stone information into Overview table for GitHub/VSCode
- Maintains standalone section for Discord format (better mobile UX)
- Improves information density by eliminating single-line standalone section
- Positioned after static attributes (ESO Plus/Title) before dynamic ones (Role/Location)

Files modified:
- src/generators/Markdown.lua (4 changes)

Related docs:
- MUNDUS_STONE_RELOCATION.md
- MUNDUS_COMPARISON.md
```

### Commit 2: Footer Cleanup
```
refactor(ui): Remove character count warnings from footer

- Removed "Large profile" warning from GitHub format
- Removed character count display from all formats
- Removed Discord/ESO clipboard truncation warnings
- Simplified footer to show only version and format name
- Changed trailing newlines from 3 to 2 for cleaner output

Rationale: Character count warnings were noisy and not actionable for users.
The ESO clipboard limit is no longer a common issue with the addon.

Files modified:
- src/generators/Markdown.lua (GenerateFooter function)
```

### Commit 3: Add Skill Bars Setting
```
feat(settings): Add toggle to hide/show skill bars section

- Implemented includeSkillBars setting (default: true)
- Added setting check to GenerateSkillBars() call
- Added toggle to Core Content Sections in settings UI
- Added default value to settings schema

This completes setting coverage for all major content sections.
Users can now hide the Combat Arsenal section if they only want
to share equipment/stats without revealing their ability setup.

Files modified:
- src/generators/Markdown.lua (setting check)
- src/settings/Defaults.lua (default value)
- src/settings/Panel.lua (UI toggle)
```

---

## Documentation Created
- `MUNDUS_STONE_RELOCATION.md` - Technical implementation details for mundus move
- `MUNDUS_COMPARISON.md` - Visual before/after comparison with test scenarios  
- `CHANGES_SUMMARY.md` - This file

---

## Backward Compatibility
âœ… All changes are fully backward compatible:
- Existing profiles will render correctly
- Default settings match previous behavior
- No saved data migration needed
- Discord format unchanged

---

## Known Limitations
None. All requested changes implemented successfully.

---

## Future Considerations
- Consider adding `includeMundus` setting if users want to hide it entirely
- Monitor feedback on footer simplification
- Skill Bars toggle may enable "stats-only" profile sharing use case
